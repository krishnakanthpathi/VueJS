<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task 2 - Advanced CRUD</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    
    <div id="app" class="p-8">
        <div class="max-w-7xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
            
            <div class="p-6 bg-gray-100 border-b border-gray-200">
                <h2 class="text-xl font-bold mb-4 text-gray-700">Add New User</h2>
                
                <button @click="openModelAddUser" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded shadow transition font-semibold">
                    + Add User
                </button>

                <div v-if="showModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
                    <div class="bg-white rounded-lg shadow-lg p-6 ">
                        <h2 class="text-xl font-bold mb-4 text-gray-700">{{ modelText }}</h2>
                        
                        <form @submit.prevent="editingIndex >= 0 ? updateUser(editingIndex) : addUser()" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                
                                <input v-model="form.name" type="text" placeholder="Name" 
                                       class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400 w-full" required/>
                                
                                <input v-model="form.email" type="email" placeholder="Email" 
                                       class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400 w-full" required/>
                                
                                <input v-model="form.dob" type="date" placeholder="Date of Birth" 
                                       class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400 w-full" required/>
                                
                                <input v-model="form.mobile" type="number" placeholder="Mobile Number" 
                                       class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400 w-full" required/>
                                
                                <input v-model="form.address" type="text" placeholder="Address" 
                                       class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400 w-full" />
                                
                                <select v-model="form.gender" 
                                        class="border p-2 rounded outline-none focus:ring-2 focus:ring-blue-400 w-full bg-white" required>
                                    <option value="" disabled>Select Gender</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>

                            <div class="flex justify-end">
                                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded shadow transition font-semibold">
                                    {{ modelText }}   
                                </button>
                                <button @click="showModal = false" class="ml-2 bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-600">
                    <thead class="bg-gradient-to-r from-blue-500 to-blue-600 text-white uppercase text-xs">
                        <tr>
                            <th class="px-6 py-3">#</th>
                            <th class="px-6 py-3">Name</th>
                            <th class="px-6 py-3">Email</th>
                            <th class="px-6 py-3">DOB</th>
                            <th class="px-6 py-3">Mobile</th>
                            <th class="px-6 py-3">Address</th>
                            <th class="px-6 py-3">Gender</th>
                            <th class="px-6 py-3 text-center">Actions</th>
                        </tr>
                    </thead>

                    <tbody>
                        <tr v-for="(user, index) in users" :key="index" class="border-b hover:bg-gray-50 transition">
                            
                            <td class="px-6 py-4 font-bold">{{ index + 1 }}</td>
                            
                            <td class="px-6 py-4">
                                <span>{{ user.name }}</span>
                            </td>

                            <td class="px-6 py-4">
                                <span>{{ user.email }}</span>
                            </td>

                            <td class="px-6 py-4 whitespace-nowrap">
                                <span>{{ user.dob }}</span>
                            </td>

                            <td class="px-6 py-4">
                                <span>{{ user.mobile }}</span>
                            </td>

                            <td class="px-6 py-4">
                                <span>{{ user.address }}</span>
                            </td>

                            <td class="px-6 py-4">
                                <span :class="{'bg-blue-100 text-blue-800': user.gender === 'Male', 'bg-pink-100 text-pink-800': user.gender === 'Female'}"
                                    class="px-2 py-1 rounded text-xs font-semibold bg-gray-100 text-gray-800">
                                    {{ user.gender }}
                                </span>
                            </td>

                            <td class="px-6 py-4 text-center whitespace-nowrap">
                                <button 
                                    @click="toggleUpdate(index)"
                                    class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-xs mr-2 transition">
                                    Edit
                                </button>
                                <button 
                                    @click="deleteUser(index)"
                                    class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-xs transition">
                                    Delete
                                </button>
                            </td>
                        </tr>

                        <tr v-if="users.length === 0">
                            <td colspan="8" class="text-center py-8 text-gray-400">
                                No records found. Please add a user above.
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

</body>

<script>
    const { createApp, ref, reactive, onMounted } = Vue;

    const app = createApp({
        setup() {
            const users = ref([
                {
                    name: 'John Doe',
                    email: 'john.doe@example.com',
                    dob: '1990-01-01',
                    mobile: '123-456-7890',
                    address: '123 Main St',
                    gender: 'Male'
                },
                {
                    name: 'Jane Smith',
                    email: 'jane.smith@example.com',
                    dob: '1992-02-02',
                    mobile: '987-654-3210',
                    address: '456 Elm St',
                    gender: 'Female'
                }
            ]);
            const showModal = ref(false);
            const modelText = ref('Add User');
            const form = reactive({
                name: '',
                email: '',
                dob: '',
                mobile: '',
                address: '',
                gender: ''
            });


            const editingIndex = ref(-1);

            // Functions

            // Add User
            const addUser = () => {
                if (!form.name || !form.email) {
                    alert("Please fill in all required fields.");
                    return;
                }

                users.value.push({ ...form }); 

                // Reset Form
                form.name = '';
                form.email = '';
                form.dob = '';
                form.mobile = '';
                form.address = '';
                form.gender = '';
                showModal.value = false;
            };

            // Delete User
            const deleteUser = (index) => {
                if (confirm("Are you sure you want to delete this user?")) {
                    users.value.pop(index, 1);
                    if (editingIndex.value === index) {
                        editingIndex.value = -1;
                    }
                }
            };

            // open add user modal
            const openModelAddUser = () => {
                // Reset Form
                form.name = '';
                form.email = '';
                form.dob = '';
                form.mobile = '';
                form.address = '';
                form.gender = '';

                editingIndex.value = -1;
                modelText.value = 'Add User';
                showModal.value = true;
            };


            // Toggle Edit/Save
            const toggleUpdate = (index) => {
                const user = users.value[index];

                for(const key in user) {
                    if (!user[key]) {
                        alert("Invalid field detected.");
                        return;
                    }
                    
                    form[key] = user[key];
                }

                users.value[index] = { ...form };
                modelText.value = 'Edit User';
                toggleModal();

                if (editingIndex.value === index) {
                    editingIndex.value = -1;
                } else {
                    editingIndex.value = index; 
                }
            };

            // update
            const updateUser = (index) => {
                users.value[index] = { ...form };

                // Reset Form
                form.name = '';
                form.email = '';
                form.dob = '';
                form.mobile = '';
                form.address = '';
                form.gender = '';
                editingIndex.value = -1;
                modelText.value = 'Add User';
                showModal.value = false;
            };

            // Toggle Modal
            const toggleModal = () => {
                showModal.value = !showModal.value;
            };


            return {
                users,
                form,
                editingIndex,
                addUser,
                deleteUser,
                toggleUpdate,
                showModal,
                modelText,
                toggleModal,
                updateUser,
                openModelAddUser
            };
        }
    });

    app.mount('#app');
</script>
</html>



<!-- 

issues 
while editing the form data is not getting populated in the modal fields



-->